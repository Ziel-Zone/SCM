{% extends "layout.html" %}

{% block title %}Laporan - Sistem Pa Wawan{% endblock %}
{% block page_title %}Laporan{% endblock %}

{% block content %}

    <div class="page-header">
        <h2>Laporan Bulanan</h2>
        <button class="btn btn-primary" id="btnExportReport" onclick="window.print()">
            Ekspor ke PDF
        </button>
    </div>

    <section class="filter-section no-print">
        <form class="report-filter-form" method="GET" action="{{ url_for('laporan') }}">
            <div class="form-group">
                <label for="filterBulan">Bulan</label>
                <select id="filterBulan" name="bulan">
                    {% for i in range(1, 13) %}
                        <option value="{{ i }}" {% if i == bulan %}selected{% endif %}>
                            {{ i }} </option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group">
                <label for="filterTahun">Tahun</label>
                <select id="filterTahun" name="tahun">
                    <option value="2025" {% if tahun == 2025 %}selected{% endif %}>2025</option>
                    <option value="2024" {% if tahun == 2024 %}selected{% endif %}>2024</option>
                </select>
            </div>
            <button type="submit" class="btn btn-primary">Tampilkan</button>
        </form>
    </section>

    <section class="summary-section">
        <h3>Ringkasan: Bulan {{ bulan }} / {{ tahun }}</h3>
        <div class="summary-grid">
            <div class="summary-card">
                <span>Total Barang Masuk</span>
                <strong>{{ total_masuk }} <small>item</small></strong>
            </div>
            <div class="summary-card">
                <span>Total Barang Keluar</span>
                <strong>{{ total_keluar }} <small>item</small></strong>
            </div>
            <div class="summary-card">
                <span>Item Terbanyak Keluar</span>
                <strong>{{ top_item }}</strong>
            </div>
        </div>
    </section>

    <section class="report-details">
        <h3>Detail Stok Per Barang</h3>
        <div class="table-responsive-container">
            <table class="report-table">
                <thead>
                    <tr>
                        <th>Nama Barang</th>
                        <th>Stok Awal (Estimasi)</th>
                        <th>Masuk</th>
                        <th>Keluar</th>
                        <th>Stok Akhir</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in laporan %}
                    <tr>
                        <td>{{ item.nama }}</td>
                        <td>{{ item.stok_awal }}</td>
                        <td><span class="text-masuk">+{{ item.masuk }}</span></td>
                        <td><span class="text-keluar">-{{ item.keluar }}</span></td>
                        <td><strong>{{ item.stok_akhir }}</strong></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </section>

{% endblock %}